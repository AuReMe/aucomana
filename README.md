# Analysis_runs

## Library to make analyse of AuCoMe tool results 

AuCoMe tool : https://github.com/AuReMe/aucome 
Workflow to reconstruct multiple metabolic networks in order to compare them.

## Installation

### Dependencies

Tools needed :
- R.

Python Packages needed :
- biopython>=1.79
- matplotlib>=3.5.1
- numpy>=1.22.3
- pandas>=1.4.2
- pyahocorasick>=1.4.4
- rpy2>=3.5.1
- venn>=0.1.3

### Install dependencies

From cloned directory :

```pip install -r requirements.txt```
```python install_R_packages.py```

## Usage

### Initialize a study

Create ```Analysis``` instance given a path of AuCoMe runs results and a study path to store analysis results :
``` py
from analysis_runs.analysis import Analysis

STUDY_PATH = 'Path/To/Study_folder'
RUNS_PATH = 'Path/To/Runs_aucome'

A = Analysis(RUNS_PATH, STUDY_PATH)
```

Initialize ```Analyse``` instance will generate the folder tree in which the result files generated by the package will be stored. The ```output_data``` folder is created in the ```STUDY_PATH ```.
```
output_data
├── compare_groups
├── dendro_tanglegrams
├── genes_data
├── metabolites_data
├── pathways_data
    ├── binary_df
├── reactions_data
    ├── genes_assoc
├── renamed_id_padmet
```

### Groups Analysis

#### Indicate groups

Most of ```Analyse``` instance methods are used to compare different groups of species. These groups are the ones indicated in the file :
> \<ID AuCoMe run\>/analysis/group_template.tsv

For good groupings in dendrograms, it is preferable that each species belongs to only one group.

Exemple of 'group_template.tsv' file filling :

all	    | HS  | IAI1 | CFT073 | UTI89 | sf301 | ec042 | LF82 
---     | --- | ---  | ---    |---    |---    |---    |--- 
group1	| HS  | IAI1 | CFT073 | UTI89 |       |       |			
group2	|     |      |        | UTI89 | sf301 | ec042 | LF82
groupA	| HS  | IAI1 |        |       |       |       |					
groupB	|     |      | CFT073 | UTI89 | sf301 |       |	
groupC	|     |      |        |       | sf301 | ec042 | LF82

Here if we want to colorize group1 and group2 in a dendrogram there will be confusion for the group determination of UTI89.
Also if we want to colorize groupA, groupB and groupC in a dendrogram there will be confusion for the group determination of sf301.

#### Dendrogram groups colorization

The indication of groups colorization has to be done in the file :
> Study_folder/output_data/dendro_tanglegrams/dendro_groups.tsv

In the file you can indicate how to colorize each group and if you want the branch or the leave to be colorize.

Exemple of 'dendro_groups.tsv' file filling :

group name | color   | element (B for branch, L for leave)
---        | ---     | --- 
group1	   | #43C268 | B
group2	   | #C25B43 | B
groupA     | blue    | L
groupB     | orange  | L
groupC     | magenta | L

Exemple of dendrogram associated :

<img src="https://github.com/PaulineGHG/analysis_runs/blob/master/tests/Study_folder/output_data/dendro_tanglegrams/bact7/rnx_test_no_phylo/rnx_test_no_phylo_dendextend_dend.png" alt="Dendrogramm" width="500"/>

## Analyze Reactions, Pathways, Metabolites and Genes

You can extract information and make some calculations from tables datas availables in 'analysis/all' from AuCoMe results.
You can do it thanks to ```Reactions```, ```Pathways```, ```Metabolites``` and ```Genes``` classes.

Commands to initoalyse these instances :

``` py
RUN = 'bact7'
A = Analysis(RUNS_PATH, STUDY_PATH)
R = A.reactions(run=RUN)
PW = A.pathways(run=RUN)
MB = A.metabolites(run=RUN)
G = A.genes(run=RUN)
```
See the documentation for full methods description : 

## Generate Dendrograms

### Commands

You can generate dendrograms from reactions, pathways or metabolites datas.
Exemple without comparing with original phylogeny file :

``` py
RUN = 'bact7'
A = Analysis(RUNS_PATH, STUDY_PATH)
R = A.reactions(run=RUN)
PW = A.pathways(run=RUN)
MB = A.metabolites(run=RUN)

R.generate_rnx_dendrogram(name="test_no_phylo", n_boot=10)
PW.generate_pw_dendrogram(df_binary_threshold=0.8, name="test_no_phylo", n_boot=10)
MB.generate_met_dendrogram(name="test_no_phylo", n_boot=10)
```
Here the number of boot is 10 for fast testing. The default value is 10 000.

### Comparison with original phylogeny

The dendrograms generation commands above allow you to compare dendrogram with original phylogeny. To do so you have to attribute a nexus file in the ```phylo_file``` parameter.

``` py
phylo_file = 'Path/To/Phylo.nexus'
PW.generate_pw_dendrogram(0.8, name="test_phylo", n_boot=10, phylo_file=phylo_file)
```



